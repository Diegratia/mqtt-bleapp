const brain = require('brain.js');

// Dataset input/output
const trainingData = [];

var datajson = `[{"id":3,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:47:56,880","meter":"1,88005408984861","calc_dist":"7,14420554142471","gmac":"282C02227F53","measure":-59},{"id":7,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:48:05,580","meter":"2,09721437756176","calc_dist":"7,96941463473468","gmac":"282C02227F53","measure":-59},{"id":11,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:48:14,893","meter":"2,01063958237826","calc_dist":"7,64043041303738","gmac":"282C02227F53","measure":-59},{"id":15,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:48:23,517","meter":"2,09319362449555","calc_dist":"7,9541357730831","gmac":"282C02227F53","measure":-59},{"id":18,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:48:32,537","meter":"2,27315234857874","calc_dist":"8,6379789245992","gmac":"282C02227F53","measure":-59},{"id":23,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-66,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:48:41,547","meter":"2,29581293207296","calc_dist":"8,72408914187726","gmac":"282C02227F53","measure":-59},{"id":26,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-70,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:48:50,797","meter":"3,11213138182335","calc_dist":"11,8260992509287","gmac":"282C02227F53","measure":-59},{"id":30,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:49:00,267","meter":"2,42015684885155","calc_dist":"9,19659602563588","gmac":"282C02227F53","measure":-59},{"id":35,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:49:08,867","meter":"2,03915881677304","calc_dist":"7,74880350373757","gmac":"282C02227F53","measure":-59},{"id":38,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-71,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:49:17,790","meter":"3,57649028013115","calc_dist":"13,5906630644984","gmac":"282C02227F53","measure":-59},{"id":43,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-68,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:49:26,907","meter":"2,89331367469242","calc_dist":"10,9945919638312","gmac":"282C02227F53","measure":-59},{"id":46,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-69,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:49:37,370","meter":"2,65193197675801","calc_dist":"10,0773415116804","gmac":"282C02227F53","measure":-59},{"id":51,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-66,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:49:45,363","meter":"2,2608297895021","calc_dist":"8,59115320010796","gmac":"282C02227F53","measure":-59},{"id":55,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-67,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:49:54,270","meter":"2,49775085436145","calc_dist":"9,49145324657351","gmac":"282C02227F53","measure":-59},{"id":60,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:50:04,087","meter":"2,28682068096582","calc_dist":"8,6899185876701","gmac":"282C02227F53","measure":-59},{"id":64,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:50:12,973","meter":"2,01786145809846","calc_dist":"7,66787354077416","gmac":"282C02227F53","measure":-59},{"id":67,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-66,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:50:21,603","meter":"3,36236371518425","calc_dist":"12,7769821177002","gmac":"282C02227F53","measure":-59},{"id":72,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-70,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:50:29,800","meter":"2,84208980128881","calc_dist":"10,7999412448975","gmac":"282C02227F53","measure":-59},{"id":75,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-70,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:50:38,687","meter":"3,19461895022642","calc_dist":"12,1395520108604","gmac":"282C02227F53","measure":-59},{"id":79,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:50:47,387","meter":"1,98641092507364","calc_dist":"7,54836151527984","gmac":"282C02227F53","measure":-59},{"id":82,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-64,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:50:56,213","meter":"2,00267179659615","calc_dist":"7,61015282706536","gmac":"282C02227F53","measure":-59},{"id":87,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:51:03,950","meter":"2,01754771215098","calc_dist":"7,66668130617371","gmac":"282C02227F53","measure":-59},{"id":90,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:51:13,363","meter":"2,35557410789372","calc_dist":"8,95118160999612","gmac":"282C02227F53","measure":-59},{"id":94,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-66,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:51:22,117","meter":"2,34872483354516","calc_dist":"8,9251543674716","gmac":"282C02227F53","measure":-59},{"id":99,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:51:30,580","meter":"1,97433547688555","calc_dist":"7,50247481216507","gmac":"282C02227F53","measure":-59},{"id":103,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:51:39,477","meter":"2,15476254174309","calc_dist":"8,18809765862374","gmac":"282C02227F53","measure":-59},{"id":106,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-64,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:51:48,700","meter":"1,85934701188635","calc_dist":"7,06551864516812","gmac":"282C02227F53","measure":-59},{"id":110,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:51:57,600","meter":"1,99661423075452","calc_dist":"7,58713407686718","gmac":"282C02227F53","measure":-59},{"id":115,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-66,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:52:06,887","meter":"2,22484636352788","calc_dist":"8,45441618140595","gmac":"282C02227F53","measure":-59},{"id":118,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-67,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:52:16,607","meter":"2,4167083129121","calc_dist":"9,18349158906599","gmac":"282C02227F53","measure":-59},{"id":122,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-67,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:52:25,107","meter":"2,65970717806839","calc_dist":"10,1068872766599","gmac":"282C02227F53","measure":-59},{"id":126,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-66,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:52:34,367","meter":"2,26023913826501","calc_dist":"8,58890872540705","gmac":"282C02227F53","measure":-59},{"id":129,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:52:43,437","meter":"2,26793893982609","calc_dist":"8,61816797133914","gmac":"282C02227F53","measure":-59},{"id":134,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:52:52,007","meter":"1,9953349017712","calc_dist":"7,58227262673056","gmac":"282C02227F53","measure":-59},{"id":137,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:53:01,570","meter":"2,03717013150642","calc_dist":"7,74124649972439","gmac":"282C02227F53","measure":-59},{"id":141,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-69,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:53:10,597","meter":"2,8828439769558","calc_dist":"10,9548071124321","gmac":"282C02227F53","measure":-59},{"id":144,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:53:19,200","meter":"2,28620860029076","calc_dist":"8,68759268110489","gmac":"282C02227F53","measure":-59},{"id":148,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:53:28,360","meter":"1,971962301857","calc_dist":"7,49345674705659","gmac":"282C02227F53","measure":-59},{"id":152,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:53:37,590","meter":"2,27806859577523","calc_dist":"8,65666066394589","gmac":"282C02227F53","measure":-59},{"id":155,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:53:45,750","meter":"2,07363523410341","calc_dist":"7,87981388959297","gmac":"282C02227F53","measure":-59},{"id":158,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:53:54,857","meter":"2,09532154069843","calc_dist":"7,96222185465403","gmac":"282C02227F53","measure":-59},{"id":164,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-64,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:54:03,643","meter":"1,84198453474963","calc_dist":"6,99954123204859","gmac":"282C02227F53","measure":-59},{"id":167,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:54:12,100","meter":"1,99198754084434","calc_dist":"7,56955265520849","gmac":"282C02227F53","measure":-59},{"id":171,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-64,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:54:20,510","meter":"1,78701221625774","calc_dist":"6,79064642177942","gmac":"282C02227F53","measure":-59},{"id":174,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:54:28,420","meter":"1,9931088320876","calc_dist":"7,57381356193289","gmac":"282C02227F53","measure":-59},{"id":179,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:54:36,937","meter":"1,98183077052433","calc_dist":"7,53095692799245","gmac":"282C02227F53","measure":-59},{"id":182,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:54:46,210","meter":"3,00406147462709","calc_dist":"11,415433603583","gmac":"282C02227F53","measure":-59},{"id":187,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:54:55,327","meter":"1,97471199015242","calc_dist":"7,50390556257921","gmac":"282C02227F53","measure":-59},{"id":191,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:55:04,953","meter":"2,23867210105417","calc_dist":"8,50695398400583","gmac":"282C02227F53","measure":-59},{"id":195,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:55:13,543","meter":"2,29103565744296","calc_dist":"8,70593549828323","gmac":"282C02227F53","measure":-59},{"id":198,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:55:22,447","meter":"1,99002771593518","calc_dist":"7,56210532055369","gmac":"282C02227F53","measure":-59},{"id":204,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:55:31,123","meter":"2,05159365700056","calc_dist":"7,79605589660212","gmac":"282C02227F53","measure":-59},{"id":207,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-64,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:55:39,833","meter":"1,89727071577981","calc_dist":"7,20962871996329","gmac":"282C02227F53","measure":-59},{"id":213,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-64,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:55:49,810","meter":"2,02948351010283","calc_dist":"7,71203733839076","gmac":"282C02227F53","measure":-59},{"id":218,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:55:59,310","meter":"2,05710005171801","calc_dist":"7,81698019652844","gmac":"282C02227F53","measure":-59},{"id":221,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:56:07,537","meter":"2,01361451955177","calc_dist":"7,65173517429672","gmac":"282C02227F53","measure":-59},{"id":226,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:56:15,583","meter":"2,1453773999638","calc_dist":"8,15243411986244","gmac":"282C02227F53","measure":-59},{"id":229,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:56:24,690","meter":"2,03712224359583","calc_dist":"7,74106452566415","gmac":"282C02227F53","measure":-59},{"id":233,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:56:34,683","meter":"2,10391292595257","calc_dist":"7,99486911861976","gmac":"282C02227F53","measure":-59},{"id":235,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:56:43,583","meter":"2,27688073824895","calc_dist":"8,65214680534601","gmac":"282C02227F53","measure":-59},{"id":239,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-67,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:56:53,080","meter":"2,34684372447281","calc_dist":"8,91800615299669","gmac":"282C02227F53","measure":-59},{"id":242,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-66,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:57:01,243","meter":"2,15427619358126","calc_dist":"8,18624953560878","gmac":"282C02227F53","measure":-59},{"id":247,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-66,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:57:09,730","meter":"2,20979074566999","calc_dist":"8,39720483354595","gmac":"282C02227F53","measure":-59},{"id":252,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:57:19,190","meter":"2,08545209230659","calc_dist":"7,92471795076503","gmac":"282C02227F53","measure":-59},{"id":256,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:57:28,533","meter":"1,99526285208885","calc_dist":"7,58199883793764","gmac":"282C02227F53","measure":-59},{"id":260,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:57:37,817","meter":"2,10986470903553","calc_dist":"8,01748589433502","gmac":"282C02227F53","measure":-59},{"id":263,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:57:47,043","meter":"2,43831758268978","calc_dist":"9,26560681422118","gmac":"282C02227F53","measure":-59},{"id":267,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:57:56,417","meter":"2,26019709371406","calc_dist":"8,58874895611341","gmac":"282C02227F53","measure":-59},{"id":269,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-66,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:58:06,380","meter":"2,15191526454228","calc_dist":"8,17727800526066","gmac":"282C02227F53","measure":-59},{"id":272,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-64,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:58:15,247","meter":"1,91714136888168","calc_dist":"7,28513720175038","gmac":"282C02227F53","measure":-59},{"id":275,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:58:24,033","meter":"2,00069036260632","calc_dist":"7,60262337790403","gmac":"282C02227F53","measure":-59},{"id":278,"gateway_id":1,"type":4,"dmac":"BC572905DB80","refpower":-59,"rssi":-65,"vbatt":"\\N","temp":"\\N","time":"2025-05-29 05:58:32,630","meter":"2,03661840475793","calc_dist":"7,73914993808014","gmac":"282C02227F53","measure":-59}]`;
var data = JSON.parse(datajson);
function convertTrainingData() {
    for(var x in data) {
        var obj = data[x];
        const x = parseInt(obj.rssi);
        const y = parseFloat(obj.calc_dist.replace(',', '.'));

        if (isNaN(x) || isNaN(y)) {

        }
        const normX = (x + 100) / 100; // asumsi RSSI dari -100 sampai 0
        const normY = y / 40;          // asumsi jarak max 40 meter
        trainingData.push({ input: [normX], output: [normY] });
    }
    console.log("Data pelatihan telah dikonversi:", trainingData.length, "data");
}

function trainNetwork() {
    convertTrainingData();
    const net = new brain.NeuralNetwork({
        hiddenLayers: [3], // satu hidden layer dengan 3 neuron
        activation: 'sigmoid', // fungsi aktivasi sigmoid
    });
    const stats = net.train(trainingData, {
      iterations: 5000,
      log: true,
      logPeriod: 500,
      errorThresh: 0.005
    });
    console.log("Model selesai dilatih. MSE:", stats.error);
    // Prediksi
    const testRSSI = -60;
    const normTestRSSI = (testRSSI + 100) / 100;
    const output = net.run([normTestRSSI]);
    const predDistance = output[0] * 10; // de-normalisasi
    console.log(`Prediksi jarak untuk RSSI ${testRSSI}: ${predDistance.toFixed(2)} meter`);
}
trainNetwork()